
  <div class="cat_partial">

<h2 id="backUpCategoryModalLabel" class="modal-title">Business Back Up - Fund Management (<%= timeRange || 'All time' %>)</h2>

<div class="category-page">
<!-- Include fund summary partial and modals -->
<%- include('fund_summary') %> <br><br>
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h3>BUSINESS BACK UP (<%= timeRange || 'All time' %>)</h3>
    <div>
      <a class="btn btn-secondary" href="/funds/back-up/pdf?<%= from ? 'from=' + from : '' %>&<%= to ? 'to=' + to : '' %>" target="_blank">Download PDF</a>
      <button class="btn btn-primary" onclick="window.print()">Print</button>
    </div>
  </div>

  <div style="display:flex; gap:12px; margin-top:8px; align-items:center;">
    <div style="background:#fff; padding:12px; border-radius:8px;">Allocated:<div><strong>TSh <%= (backUp?.allocated || 0).toLocaleString() %></strong></div></div>
    <div style="background:#fff; padding:12px; border-radius:8px;">Used:<div><strong>TSh <%= (backUp?.used || 0).toLocaleString() %></strong></div></div>
    <div style="background:#fff; padding:12px; border-radius:8px; margin-left:auto;">Available:<div><strong>TSh <%= (backUp?.available || ((backUp?.allocated || 0) - (backUp?.used || 0)) || 0).toLocaleString() %></strong></div></div>
  </div>

  <!-- empty spacer (kept intentionally) -->
  <div style="height:12px;"></div>

  <h4>Business Back Up Transactions (<%= timeRange || 'All time' %>)</h4>
  <table style="width:100%; border-collapse:collapse;">
    <thead>
      <tr>
        <th style="border:1px solid #ddd; padding:8px;">TN</th>
        <th style="border:1px solid #ddd; padding:8px;">Member</th>
        <th style="border:1px solid #ddd; padding:8px;">Amount (TSh)</th>
        <th style="border:1px solid #ddd; padding:8px;">Date</th>
        <th style="border:1px solid #ddd; padding:8px;">Status</th>
      </tr>
    </thead>
    <tbody>
      <% if (backUpTransactions && backUpTransactions.length) { %>
        <% backUpTransactions.forEach((t, idx) => { %>
          <tr>
            <td style="border:1px solid #eee; padding:8px;">
         <% 
       const index = idx + 1; 
       const requestId = t.id || t.txn_no || index; 
         %>
           TRN <%= index %>-<%= requestId %>
       </td>
            <td style="border:1px solid #eee; padding:8px;"><%= t.member_first_name %> <%= t.member_surname %></td>
            <td style="border:1px solid #eee; padding:8px;"><%= (t.amount || 0).toLocaleString() %></td>
            <td style="border:1px solid #eee; padding:8px;"><%= t.date ? new Date(t.date).toDateString() : '' %></td>
            <td style="border:1px solid #eee; padding:8px;"><%= t.status || 'Completed' %></td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr><td colspan="6" style="text-align:center; padding:12px;">No transactions found for the selected time range.</td></tr>
      <% } %>
    </tbody>
    <tfoot>
     <tr>
    <td colspan="2" style="padding:8px; text-align:right;"><strong>Total BackUp Transactions (<%= timeRange || 'All time' %>)</strong></td>
   <td style="padding:8px;"><strong>TSh <%= (backUpTransactionsTotal || 0).toLocaleString() %></strong></td>     
   <td></td>
   </tr>
    </tfoot>
  </table>
</div>
</div>
