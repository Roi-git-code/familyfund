
<div class="cat_partial">
<h2 id="emergencyCategoryModalLabel" class="modal-title">Emergency - Fund Management (<%= timeRange || 'All time' %>)</h2>

<!-- Include fund summary partial and modals -->
<%- include('fund_summary') %>
<div class="category-page">
<div style="display:flex; justify-content:space-between; align-items:center;">
<br><br>
<h2>EMERGENCY (<%= timeRange || 'All time' %>)</h2>
<div>
<a class="btn btn-secondary" href="/funds/emergency/pdf?<%= from ? 'from=' + from : '' %>&<%= to ? 'to=' + to : '' %>" target="_blank">Download PDF</a>
<button class="btn btn-primary" onclick="window.print()">Print</button>
</div>
</div>


<div style="display:flex; gap:12px; margin-top:8px;">
<div style="background:#fff; padding:12px; border-radius:8px;"><h4>Total Emergency Fund</h4> (<%= timeRange || 'All time' %>)<div><strong>TSh <%= (emergency?.total || 0).toLocaleString() %></strong></div></div>
<div style="background:#fff; padding:12px; border-radius:8px;"><h4>Used:</h4><div><strong>TSh <%= (emergency?.used || 0).toLocaleString() %></strong></div></div>
<div style="background:#fff; padding:12px; border-radius:8px;"><h4>Available Emergency Fund</h4><div><strong>TSh <%= (emergency?.available || 0).toLocaleString() %></strong></div></div>
</div>


<!-- empty row (kept intentionally empty as requested) -->
<div style="height:12px;"></div>


<h4>Emergency Transactions (<%= timeRange || 'All time' %>)</h4>
<table style="width:100%; border-collapse:collapse;">
<thead>
<tr><th>TN</th><th>Member</th><th>Amount (TSh)</th><th>Date</th></tr>
</thead>
<tbody>
<% if (emergencyTransactions && emergencyTransactions.length) { %>
<% emergencyTransactions.forEach((t, idx) => { %>
<tr>
<td>
  <% 
    const index = idx + 1; 
    const requestId = t.id || t.txn_no || index; 
  %>
  TRN <%= index %>-<%= requestId %>
</td>

<td><%= t.member_first_name %> <%= t.member_surname %></td>
<td><%= (t.amount || 0).toLocaleString() %></td>
<td><%= t.date ? new Date(t.date).toDateString() : '' %></td>
</tr>
<% }) %>
<% } else { %>
<tr><td colspan="4" style="text-align:center;">No transactions found.</td></tr>
<% } %>
</tbody>
<tfoot>

<tr>
<td colspan="2" style="padding:8px; text-align:right;"><strong>Total Emergency Transactions (<%= timeRange || 'All time' %>)</strong></td>
<td style="padding:8px;"><strong>TSh <%= (emergencyTransactionsTotal || 0).toLocaleString() %></strong></td>
<td></td>
</tr>
</tfoot>
</table>
</div>
